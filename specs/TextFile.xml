<?xml version="1.0"?>
<!DOCTYPE signalml SYSTEM "SignalML_2_0.dtd">
<signalml>

	<header>
		<text_info>test file for text type</text_info>
		<url>sometestfile</url>
	</header>


	<file id='main' type='text'>
		<!---->
		<param id='number_of_channels' type='int'>
			<format>'|u1'</format>
			<line>-1</line>
			<pattern>"MSI.MegChanCount: ([0-9]*)"</pattern>
			<group>1</group>
		</param>

		<param id='sampling_frequency' type='float' units='Hz'>
			<format>'&lt;f4'</format>
			<line>-1</line>
			<pattern>"MSI.SampleFrequency: ([0-9]+.[0-9]*)"</pattern>
			<group>1</group>
		</param>

		<param id='number_of_samples' type='int'>
			<expr>slices_per_epoch * total_epochs </expr>
		</param>

		<param id='meg_chan_index' type='str'>
			<format>'|S2'</format>
			<line>-1</line>
			<pattern>"MSI.MegChanIndex: ([0-9,]+)$"</pattern>
			<group>1</group>
		</param>

		<param id='total_epochs' type='int'>
			<format>'|u1'</format>
			<line>-1</line>
			<pattern>"MSI.TotalEpochs: ([0-9]*)"</pattern>
			<group>1</group>
		</param>

		<param id='slices_per_epoch' type='int'>
			<format>'|u1'</format>
			<line>-1</line>
			<pattern>"MSI.SlicesPerEpoch: ([0-9]*)"</pattern>
			<group>1</group>
		</param>

		<param id='total_channels' type='int'>
			<format>'|u1'</format>
			<line>-1</line>
			<pattern>"MSI.TotalChannels: ([0-9]*)"</pattern>
			<group>1</group>
		</param>

		<param id='get_data_filename' type='str'>
			<format>'|S2'</format>
			<line>-1</line>
			<pattern>"MSI.FileDescriptor: (.+;){4}([a-zA-Z0-9,._-]+)"</pattern>
			<group>2</group>
		</param>

		<channelset id='data_test' filename='a.txt'>

			<for-each id='channels' var='index' sequence='range(number_of_channels)'>
				<channel mapping='mapping' format='"&gt;f4"' 
							length='number_of_samples' data='data_file' fast='1' />
				
				<file id='data_file' type='binary' filename='get_data_filename'>
				</file>
				
				<param id='channel_name' type='str'>
					<format>'|S1'</format>
					<line>-1</line>
					<pattern>single_channel_name_pattern</pattern>
					<group>2</group>
				</param>

				<param id='single_channel_name_pattern' type='str'>
					<expr>"MSI.MegChanNames: ([a-zA-Z0-9]+,){" + str(index) + "}([A-Za-z0-9]+)"</expr>
				</param>

				<param id='channel_index' type='int'>
					<format>'|u1'</format>
					<line>-1</line>
					<pattern>single_channel_index_pattern</pattern>
					<group>2</group>
				</param>

				<param id='single_channel_index_pattern' type='str'>
					<expr>"MSI.MegChanIndex: ([0-9]+,){" + str(index) + "}([0-9]+)"</expr>
				</param>

				<param id='mapping' type='int'>
					<arg type='int' name='sample' />
					<expr>(sample*total_channels + channel_index -1) * 4</expr>
				</param>

				<param id='calibration_gain' type='float' units='Î¼V'>
					<expr>'1.0e15f'</expr>
				</param>

 			</for-each>
		</channelset>


	</file>

</signalml>

